import yfinance as yf
import datetime
import json

def get_hot_stocks():
    # 模擬熱門股票代號池（實際應從API或爬蟲獲取）
    symbols = [
        "2603.TW", "2615.TW", "2609.TW", "1101.TW", "1301.TW", "1402.TW", "2002.TW",
        "2301.TW", "2324.TW", "2357.TW", "2382.TW", "2451.TW", "2606.TW", "3034.TW",
        "3702.TW", "4904.TW", "1216.TW", "1326.TW", "2395.TW", "3231.TW",
        "8046.TW", "2412.TW", "3008.TW", "2882.TW", "2345.TW", "2207.TW", "2105.TW",
        "2881.TW", "2891.TW", "2801.TW"
    ]

    top_stocks = []
    for symbol in symbols:
        try:
            ticker = yf.Ticker(symbol)
            df = ticker.history(period='1d', interval='1m')
            df_filtered = df.between_time("09:00", "09:03")
            total_volume = df_filtered['Volume'].sum()
            if total_volume > 0:
                top_stocks.append((symbol.replace(".TW", ""), total_volume))
        except:
            continue

    # 按成交量排序，取前30名
    top_stocks = sorted(top_stocks, key=lambda x: x[1], reverse=True)[:30]
    
    result = [{"symbol": sym, "name": "熱門股"} for sym, _ in top_stocks]
    with open("stocks.json", "w", encoding="utf-8") as f:
        json.dump(result, f, ensure_ascii=False, indent=2)
    return result

if __name__ == "__main__":
    print(get_hot_stocks())
